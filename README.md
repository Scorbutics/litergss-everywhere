# LiteRGSS-Everywhere

A modern, modular CMake-based cross-compilation system for LiteRGSS (Lightweight Ruby Game Scripting System) targeting multiple platforms including Android, Linux, macOS, and iOS.

## Overview

LiteRGSS-Everywhere provides a complete build environment for compiling LiteRGSS2 and all its dependencies for cross-platform deployment. Built on the proven ruby-for-android architecture, it features a **two-layer design** separating generic build infrastructure from application-specific configuration.

## Supported Platforms

- âœ… **Android** (ARM64, x86_64) - API 26+ (Android 8.0+)
- ğŸš§ **Linux** (x86_64, ARM64) - Ready for implementation
- ğŸš§ **macOS** - Planned
- ğŸš§ **iOS** - Planned

## Architecture

### Two-Layer Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Application Layer (LiteRGSS-specific)    â”‚
â”‚   - cmake/litergss-app/                    â”‚
â”‚   - Dependency definitions                 â”‚
â”‚   - Application-specific patches           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Core Build System (Generic, Reusable)    â”‚
â”‚   - cmake/core/ (symlink to submodule)     â”‚
â”‚   - Platform detection & configuration     â”‚
â”‚   - Generic build helpers                  â”‚
â”‚   - ExternalProject infrastructure         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Features

- **ğŸ¯ Modular Design**: Clean separation between core build system and application code
- **ğŸ”§ Platform-Aware**: Automatic platform detection and configuration
- **ğŸ“¦ ExternalProject**: Industry-standard CMake dependency management
- **ğŸ”„ Ruby Integration**: Seamless integration via ruby-for-android submodule
- **ğŸ“‹ Organized Patches**: Systematic patch management with series files
- **âœ… Validated Configuration**: Pre-build validation of required variables
- **ğŸ§¹ Granular Control**: Individual build and clean targets for each dependency

## Dependencies

LiteRGSS-Everywhere builds and packages the following libraries:

**Foundation** (via tarballs):
- libogg 1.3.4
- libvorbis 1.3.7
- FLAC 1.3.2
- FreeType 2.10.4
- OpenAL Soft 1.21.1
- patchelf 0.12 (host tool)

**Graphics & Game Engine** (via git):
- SFML 2.6.1-es2 (OpenGL ES2 fork)
- LiteCGSS 1.0.0
- LiteRGSS2 2.0.0

**Ruby Integration** (via submodule):
- ruby-for-android (CRuby 3.1.1+)
- ruby-sfml-audio 1.0.0

## Quick Start

### Prerequisites

**Option 1: Docker (Recommended)**
```bash
# Docker installed and running
docker --version
docker-compose --version
```

**Option 2: Local Build**
```bash
# Required tools
cmake --version  # 3.10+
make --version
ruby --version   # 3.0.0+

# For Android builds
export ANDROID_NDK=/path/to/android-ndk  # r22b+
```

### Building with Docker

```bash
# 1. Clone and initialize
git clone <your-repo-url> litergss-everywhere
cd litergss-everywhere
git submodule update --init --recursive

# 2. Configure (uses Docker by default)
./configure

# 3. Build
make

# 4. Export artifacts
make install

# Output: ./target/litergss-android-arm64.zip
```

### Building Without Docker

```bash
# 1. Set up environment
export ANDROID_NDK=/path/to/android-ndk

# 2. Configure for local build
./configure --without-docker

# 3. Build and install
make
make install
```

### Selecting Target Platform

```bash
# Android ARM64 (default)
./configure --with-toolchain-params=toolchain-params/arm64-v8a-android-toolchain.params

# Android x86_64
./configure --with-toolchain-params=toolchain-params/x86_64-android-toolchain.params

# Linux x86_64
./configure --without-docker --with-toolchain-params=toolchain-params/x86_64-linux-toolchain.params
```

## Build Targets

```bash
make help              # Show all available targets
make build             # Build all dependencies
make install           # Export build artifacts to ./target
make clean             # Clean build artifacts (keeps downloads)
make clean-libs        # Clean library build directories
make clean-downloads   # Remove downloaded source archives
make clean-artifacts   # Remove target directory
make clean-all         # Clean everything
```

## Directory Structure

```
litergss-everywhere/
â”œâ”€â”€ CMakeLists.txt                  # Application declaration
â”œâ”€â”€ configure                       # Configuration script
â”œâ”€â”€ Makefile                        # Generated by configure
â”œâ”€â”€ README.md                       # This file
â”œâ”€â”€ toolchain-params/               # Platform configurations
â”‚   â”œâ”€â”€ arm64-v8a-android-toolchain.params
â”‚   â”œâ”€â”€ x86_64-android-toolchain.params
â”‚   â”œâ”€â”€ x86_64-linux-toolchain.params
â”‚   â””â”€â”€ arm64-linux-toolchain.params
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile                  # Build environment
â”‚   â””â”€â”€ docker-compose.yml          # Docker orchestration
â”œâ”€â”€ external/
â”‚   â””â”€â”€ ruby-for-android/           # Git submodule
â”œâ”€â”€ cmake/
â”‚   â”œâ”€â”€ core/                       # Symlink to ruby-for-android core
â”‚   â””â”€â”€ litergss-app/
â”‚       â”œâ”€â”€ dependencies/           # Dependency .cmake files
â”‚       â””â”€â”€ patches/                # Organized patches
â”‚           â”œâ”€â”€ sfml/android/
â”‚           â”œâ”€â”€ litergss2/android/
â”‚           â””â”€â”€ ruby-sfml-audio/android/
â””â”€â”€ build/                          # Generated (gitignored)
    â””â”€â”€ target/                     # Build artifacts
```

## Output Artifacts

After `make install`, find archives in `./target/`:

- **litergss-android-arm64.zip** - Complete LiteRGSS package
  - All shared libraries (.so files)
  - Ruby standard library
  - Header files
  - Ready for APK integration

- **ruby_full-android-arm64.zip** - Ruby runtime (from submodule)

## Customization

### Adding a New Dependency

1. Create `cmake/litergss-app/dependencies/mydep.cmake`:

```cmake
set(MYDEP_VERSION "1.0.0")
set(MYDEP_URL "https://example.com/mydep-1.0.0.tar.gz")
set(MYDEP_HASH "SHA256=...")

add_external_dependency(
    NAME mydep
    VERSION ${MYDEP_VERSION}
    URL ${MYDEP_URL}
    URL_HASH ${MYDEP_HASH}
    CONFIGURE_COMMAND ./configure --host=${HOST_TRIPLET}
    DEPENDS other_dep  # Optional
)
```

2. Add to `CMakeLists.txt` APP_DEPENDENCIES list

3. Add patches (if needed) in `cmake/litergss-app/patches/mydep/{platform}/`

### Platform-Specific Patches

Patches are organized by library and platform with series files:

```
cmake/litergss-app/patches/
â””â”€â”€ library-name/
    â”œâ”€â”€ android/
    â”‚   â”œâ”€â”€ series              # Patch order
    â”‚   â””â”€â”€ fix-something.patch
    â”œâ”€â”€ linux/
    â”‚   â””â”€â”€ series
    â””â”€â”€ common/
        â””â”€â”€ series
```

The `series` file lists patches in application order:
```
# Comment
patch-1.patch
patch-2.patch
```

## Troubleshooting

### Docker Issues

```bash
# Container not starting
docker-compose down
docker-compose up -d litergss-dev

# Rebuild Docker image
docker-compose build --no-cache
```

### Build Failures

```bash
# Check logs (local build)
cat build/{dependency}/build_dir/stamps/*-err.log

# Rebuild specific dependency
make clean-libs
make {dependency}

# Full clean rebuild
make clean-all
./configure
make
```

### Common Issues

**Issue**: `cmake/core not found`
- **Solution**: Run `git submodule update --init --recursive`

**Issue**: `ANDROID_NDK not found`
- **Solution**: Set `export ANDROID_NDK=/path/to/ndk`

**Issue**: Build fails with missing headers
- **Solution**: Ensure dependencies build in correct order (check DEPENDS in .cmake files)

## Contributing

Contributions welcome! Areas of interest:
- Testing on different platforms
- Additional platform support (Linux, macOS, iOS)
- Build optimization
- Documentation improvements
- Bug fixes

## License

See [LICENSE](LICENSE) file for details.

## Acknowledgments

- Based on the excellent [ruby-for-android](https://github.com/Scorbutics/ruby-for-android) architecture
- SFML OpenGL ES2 fork by Scorbutics
- All upstream library maintainers

## Project Status

**Current**: Phase 1 Complete - Foundation and all dependencies implemented
- âœ… Directory structure
- âœ… Build system integration
- âœ… All dependency configurations
- âœ… Patch migration
- âœ… Docker support
- ğŸš§ Testing and validation

**Next Steps**:
1. Build testing in Docker environment
2. Validate all dependency builds
3. Test final archive creation
4. Platform expansion (Linux, macOS, iOS)
